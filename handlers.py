from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ContextTypes, CallbackQueryHandler
from database import db, Task
from ai_helper import generate_ai_response
import datetime
from telegram import Update
from telegram.ext import ContextTypes

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π AI-–ø–æ–º–æ—â–Ω–∏–∫ —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –ø–∏—Ç–æ–º—Ü–µ–º. "
        "–î–∞–≤–∞–π –Ω–∞—á–Ω–µ–º —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–≤–æ–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏!"
    )



async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    help_text = """
ü§ñ *–ü–æ–º–æ—â—å –ø–æ –∫–æ–º–∞–Ω–¥–∞–º –±–æ—Ç–∞-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞* ü§ñ

*–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:*
/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
/add - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É (–º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏)
/list - –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –≤–∞—à–∏ –∑–∞–¥–∞—á–∏
/edit - –ò–∑–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–¥–∞—á—É
/done [ID] - –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é
/delete [ID] - –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É

*–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞:*
üêæ _–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–∏—Ç–æ–º–µ—Ü_ - —Ä–∞—Å—Ç–µ—Ç –≤–º–µ—Å—Ç–µ —Å –≤–∞—à–∏–º–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏
‚è∞ _–ê–≤—Ç–æ–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è_ - –±–æ—Ç –Ω–∞–ø–æ–º–Ω–∏—Ç –æ –∑–∞–¥–∞—á–∞—Ö –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
üìä _–ê–Ω–∞–ª–∏—Ç–∏–∫–∞_ - –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –æ –≤–∞—à–µ–π –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
üí° _AI-—Å–æ–≤–µ—Ç—ã_ - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ç–∞–π–º-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç—É

*–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:*
1. –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ "–ö—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ –∑–∞–≤—Ç—Ä–∞ –≤ 18:00" - –±–æ—Ç —Å–∞–º —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –∑–∞–¥–∞—á—É –∏ –≤—Ä–µ–º—è
2. –û—Ç–≤–µ—Ç—å—Ç–µ "–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ 19:00" –Ω–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ, —á—Ç–æ–±—ã –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤—Ä–µ–º—è
3. –ù–∞–ø–∏—à–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –∫ –∑–∞–¥–∞—á–µ 5: –∫—É–ø–∏—Ç—å –µ—â–µ —Ö–ª–µ–±" –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è

*–í–∞—à –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–∏—Ç–æ–º–µ—Ü:*
üê£ –£—Ä–æ–≤–µ–Ω—å 1: 0-10 –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
üê• –£—Ä–æ–≤–µ–Ω—å 2: 11-30 –∑–∞–¥–∞—á
üêî –£—Ä–æ–≤–µ–Ω—å 3: 31+ –∑–∞–¥–∞—á

–î–ª—è —Å–≤—è–∑–∏ —Å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º: @your_username
"""

    await update.message.reply_text(help_text, parse_mode='Markdown')

#async def add_task(update: Update, context: ContextTypes.DEFAULT_TYPE):
    # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
#    pass
async def add_task(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    task_text = update.message.text
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–¥–∞—á—É –≤ –ë–î
    task_id = db.add_task(user_id, task_text)
    
    # AI-–æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ OpenRouter
    ai_response = await generate_ai_response(
        f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–∏–ª –∑–∞–¥–∞—á—É: {task_text}. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥."
    )
    
    await update.message.reply_text(ai_response)
# –î—Ä—É–≥–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏...